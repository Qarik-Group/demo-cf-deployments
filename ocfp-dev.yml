---
genesis:
  env:      ocfp-dev 
  bosh_env: dev

kit:
  name: cf
  version: 2.2.0-rc.14
  features:
    - (( append ))
    - postgres-db
    - aws-blobstore

params:
  external_db_ca: |
    -----BEGIN CERTIFICATE-----
    MIIEBjCCAu6gAwIBAgIJAMc0ZzaSUK51MA0GCSqGSIb3DQEBCwUAMIGPMQswCQYD
    VQQGEwJVUzEQMA4GA1UEBwwHU2VhdHRsZTETMBEGA1UECAwKV2FzaGluZ3RvbjEi
    MCAGA1UECgwZQW1hem9uIFdlYiBTZXJ2aWNlcywgSW5jLjETMBEGA1UECwwKQW1h
    em9uIFJEUzEgMB4GA1UEAwwXQW1hem9uIFJEUyBSb290IDIwMTkgQ0EwHhcNMTkw
    ODIyMTcwODUwWhcNMjQwODIyMTcwODUwWjCBjzELMAkGA1UEBhMCVVMxEDAOBgNV
    BAcMB1NlYXR0bGUxEzARBgNVBAgMCldhc2hpbmd0b24xIjAgBgNVBAoMGUFtYXpv
    biBXZWIgU2VydmljZXMsIEluYy4xEzARBgNVBAsMCkFtYXpvbiBSRFMxIDAeBgNV
    BAMMF0FtYXpvbiBSRFMgUm9vdCAyMDE5IENBMIIBIjANBgkqhkiG9w0BAQEFAAOC
    AQ8AMIIBCgKCAQEArXnF/E6/Qh+ku3hQTSKPMhQQlCpoWvnIthzX6MK3p5a0eXKZ
    oWIjYcNNG6UwJjp4fUXl6glp53Jobn+tWNX88dNH2n8DVbppSwScVE2LpuL+94vY
    0EYE/XxN7svKea8YvlrqkUBKyxLxTjh+U/KrGOaHxz9v0l6ZNlDbuaZw3qIWdD/I
    6aNbGeRUVtpM6P+bWIoxVl/caQylQS6CEYUk+CpVyJSkopwJlzXT07tMoDL5WgX9
    O08KVgDNz9qP/IGtAcRduRcNioH3E9v981QO1zt/Gpb2f8NqAjUUCUZzOnij6mx9
    McZ+9cWX88CRzR0vQODWuZscgI08NvM69Fn2SQIDAQABo2MwYTAOBgNVHQ8BAf8E
    BAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUc19g2LzLA5j0Kxc0LjZa
    pmD/vB8wHwYDVR0jBBgwFoAUc19g2LzLA5j0Kxc0LjZapmD/vB8wDQYJKoZIhvcN
    AQELBQADggEBAHAG7WTmyjzPRIM85rVj+fWHsLIvqpw6DObIjMWokpliCeMINZFV
    ynfgBKsf1ExwbvJNzYFXW6dihnguDG9VMPpi2up/ctQTN8tm9nDKOy08uNZoofMc
    NUZxKCEkVKZv+IL4oHoeayt8egtv3ujJM6V14AstMQ6SwvwvA93EP/Ug2e4WAXHu
    cbI1NAbUgVDqp+DRdfvZkgYKryjTWd/0+1fS8X1bBZVWzl7eirNVnHbSH2ZDpNuY
    0SBd8dj5F6ld3t58ydZbrTHze7JJOd8ijySAp4/kiu9UfZWuTPABzDa/DSdz9Dk/
    zPW4CXXvhLmE02TA9/HeCw3KEHIwicNuEfw=
    -----END CERTIFICATE-----

  # Cloud Foundry base domain
  base_domain: codex.starkandwayne.com
  system_domain: system.codex.starkandwayne.com
  apps_domains: apps.codex.starkandwayne.com

  # External PostgreSQL configuration
  external_db_host:     snw-dev-cf-db.cmziohdu4x1g.us-west-2.rds.amazonaws.com
  external_db_username:  ((external_db_user))
  #external_db_password: ((external_db_password))

  # CF Databases
  #uaadb_password:          ((uaa_db_password))
  #ccdb_password:           ((cloud_controller_db_password))
  #diegodb_password:        ((diego_db_password))
  #policyserverdb_password: ((network_policy_db_password))
  #silkdb_password:         ((network_connectivity_db_password))
  #routingapidb_password:   ((routing_api_db_password))
  #locketdb_password:       ((locket_db_password))
  #credhubdb_password:      ((credhub_db_password))

  # External Blobstore
  blobstore_s3_region: us-west-2
  skip_ssl_validation: true # Skip SSL validation since we use self-signed certs
  blobstore_app_packages_directory: codex-uswest2-dev-app-packages
  blobstore_buildpacks_directory:   codex-uswest2-dev-buildpacks
  blobstore_droplets_directory:     codex-uswest2-dev-droplets
  blobstore_resources_directory:    codex-uswest2-dev-resources

instance_groups:

- name: router
  vm_extensions:
    - cf-router-network-properties
    #- dev-alb
    #- dev-nlb

- name: diego-api
  jobs:
  - name: silk-controller
    release: silk
    properties:
      database:
        ca_cert: (( grab params.external_db_ca ))
        require_ssl: true

- name: api
  jobs:
  - name: routing-api
    release: routing
    properties:
      routing_api:
        sqldb:
          ca_cert: (( grab params.external_db_ca ))
  - name: policy-server
    release: cf-networking
    properties:
      database:
        ca_cert: (( grab params.external_db_ca ))
        require_ssl: true

- name: uaa
  jobs:
  - name: uaa
    properties:
      uaadb:
        tls: enabled
      uaa:
        ca_certs:
        - (( append ))
        - (( grab params.external_db_ca ))
